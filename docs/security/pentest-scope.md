# Penetration Test Scope - Dependency Mapping Platform

**Document Version:** 1.0.0
**Last Updated:** 2026-02-05
**Classification:** Confidential - Security Testing
**NFR Reference:** NFR-SEC-009

---

## 1. Executive Summary

This document defines the scope, methodology, and rules of engagement for penetration testing of the Dependency Mapping Platform (Code Reviewer). The test aims to identify security vulnerabilities before production deployment.

**Test Window:** Week 21-22 (5 business days)
**Test Type:** Gray Box (credentials provided, limited documentation)
**Environment:** Staging environment (isolated from production)

---

## 2. In Scope

### 2.1 API Endpoints

| Category | Endpoints | Priority |
|----------|-----------|----------|
| Authentication | `/api/v1/auth/*` | Critical |
| Scans | `/api/v1/scans/*` | High |
| Graph | `/api/v1/graph/*` | High |
| Nodes | `/api/v1/nodes/*` | Medium |
| Edges | `/api/v1/edges/*` | Medium |
| Evidence | `/api/v1/evidence/*` | Medium |
| Webhooks | `/api/v1/webhooks/*` | High |
| API Keys | `/api/v1/api-keys/*` | Critical |
| Health | `/health`, `/ready` | Low |

**Base URL:** `https://staging-api.code-reviewer.example.com`

**API Documentation:** OpenAPI spec available at `/docs`

### 2.2 Authentication Flows

| Flow | Description | Test Focus |
|------|-------------|------------|
| OAuth2 + PKCE | GitHub/GitLab authentication | Token theft, CSRF, redirect manipulation |
| JWT Access | Short-lived access tokens | Algorithm confusion, claim manipulation |
| JWT Refresh | Long-lived refresh tokens | Token reuse, rotation bypass |
| API Keys | Service-to-service auth | Key extraction, scope bypass |
| Webhooks | Signature verification | Signature forgery, replay attacks |

### 2.3 Multi-Tenant Isolation

| Test Area | Description |
|-----------|-------------|
| RLS Bypass | Attempt to access other tenant data |
| IDOR | Parameter manipulation for cross-tenant access |
| Session Mixing | Token reuse across tenants |
| Query Injection | SQL/NoSQL injection for RLS bypass |

**Test Tenants Provided:**
- `tenant-pentest-a` (Attacker tenant)
- `tenant-pentest-b` (Victim tenant with sample data)

### 2.4 Git Adapter Operations

| Operation | Endpoint | Test Focus |
|-----------|----------|------------|
| Clone | `POST /api/v1/scans` | SSRF, path traversal |
| Webhook Receive | `POST /api/v1/webhooks/github` | Signature bypass |
| Token Storage | Internal | Token extraction |

### 2.5 Graph Query Engine

| Feature | Test Focus |
|---------|------------|
| Graph Traversal | Query complexity DoS |
| Search | Injection in search terms |
| Filters | Filter bypass, information disclosure |
| Pagination | Cursor manipulation |

---

## 3. Out of Scope

### 3.1 Third-Party Services

| Service | Reason |
|---------|--------|
| GitHub.com | External provider, separate security team |
| GitLab.com | External provider, separate security team |
| AWS Services | Covered by AWS shared responsibility |
| CDN (CloudFront) | AWS managed, configuration review only |

**Note:** Testing OAuth flows with these providers is in scope; attacking the providers is not.

### 3.2 Infrastructure (Separate Review)

| Component | Reason |
|-----------|--------|
| AWS VPC | Infrastructure audit scheduled separately |
| Kubernetes Cluster | Container security audit Q2 2026 |
| Database Servers | RDS managed, focus on application layer |
| CI/CD Pipeline | DevSecOps audit in progress |

### 3.3 Physical Security

Not applicable - cloud-hosted platform.

### 3.4 Social Engineering

- No phishing campaigns
- No pretexting
- No physical access attempts

### 3.5 Denial of Service (Production)

- No load testing against production
- Staging DoS tests require 24h advance notice
- Rate limiting tests should not exceed 10x normal traffic

---

## 4. Test Types

### 4.1 OWASP Top 10 (2021)

| Category | In Scope | Notes |
|----------|----------|-------|
| A01: Broken Access Control | Yes | Multi-tenant focus |
| A02: Cryptographic Failures | Yes | Token handling, encryption |
| A03: Injection | Yes | SQL, NoSQL, HCL, command |
| A04: Insecure Design | Yes | Business logic flaws |
| A05: Security Misconfiguration | Yes | Headers, CORS, debug modes |
| A06: Vulnerable Components | Limited | Dependency scan only |
| A07: Auth Failures | Yes | Primary focus area |
| A08: Software Integrity | Yes | Webhook signatures |
| A09: Logging Failures | Yes | Information disclosure in logs |
| A10: SSRF | Yes | Git clone operations |

### 4.2 Authentication/Authorization Testing

| Test | Description | Expected Behavior |
|------|-------------|-------------------|
| Token Expiration | Use expired JWT | 401 Unauthorized |
| Algorithm None | JWT with alg:none | 401 Unauthorized |
| Algorithm HS256 | JWT with symmetric alg | 401 Unauthorized |
| Missing Claims | JWT without required claims | 401 Unauthorized |
| Invalid Signature | Tampered JWT | 401 Unauthorized |
| Cross-Tenant Token | Tenant A token on Tenant B | 403 Forbidden or 404 |
| Revoked Token | Use after logout | 401 Unauthorized |
| API Key Expired | Use expired key | 401 Unauthorized |
| API Key Scope | Exceed key permissions | 403 Forbidden |
| Brute Force | Rapid auth attempts | 429 Too Many Requests |

### 4.3 Business Logic Testing

| Test | Description |
|------|-------------|
| Scan Manipulation | Modify scan in progress |
| Result Tampering | Alter scan results post-completion |
| Quota Bypass | Exceed tenant limits |
| Workflow Bypass | Skip required steps |
| Race Conditions | Concurrent operations |

### 4.4 API Fuzzing

| Target | Fuzzing Strategy |
|--------|------------------|
| Path Parameters | Type confusion, traversal |
| Query Parameters | Injection, overflow |
| Request Bodies | Schema violation, nested depth |
| Headers | Injection, malformed |
| Content Types | Type confusion |

**Fuzzing Tools Approved:**
- Burp Suite Professional
- OWASP ZAP
- Custom scripts (share with team)

---

## 5. Test Credentials

### 5.1 Tenant A (Attacker)

```yaml
tenant_id: tenant-pentest-a
users:
  - email: attacker-admin@pentest.example.com
    role: admin
    password: [provided separately]
  - email: attacker-dev@pentest.example.com
    role: developer
    password: [provided separately]
api_keys:
  - name: pentest-key-a-full
    scopes: [scan:read, scan:write, graph:read]
  - name: pentest-key-a-readonly
    scopes: [scan:read]
```

### 5.2 Tenant B (Victim - Do Not Modify)

```yaml
tenant_id: tenant-pentest-b
users:
  - email: victim-admin@pentest.example.com
    role: admin
    # Password NOT provided - testing unauthorized access
data:
  - 10 sample scans
  - 500 sample nodes
  - 1000 sample edges
  - Sensitive repository tokens (encrypted)
```

### 5.3 OAuth Test Accounts

```yaml
github:
  - username: pentest-github-user
    org: pentest-org
    repos: [test-repo-1, test-repo-2]
gitlab:
  - username: pentest-gitlab-user
    group: pentest-group
    repos: [test-repo-a, test-repo-b]
```

---

## 6. Rules of Engagement

### 6.1 Allowed Activities

- Automated vulnerability scanning (coordinated)
- Manual penetration testing
- Authentication bypass attempts
- Injection testing
- Business logic testing
- API fuzzing (rate limited)

### 6.2 Prohibited Activities

- Testing against production environment
- Denial of service against production
- Social engineering
- Physical security testing
- Attacking third-party services
- Data exfiltration (report findings only)
- Modifying Tenant B data
- Persisting access (clean up after tests)

### 6.3 Communication

| Event | Contact | Method | SLA |
|-------|---------|--------|-----|
| Critical Finding | security@example.com | Encrypted email | Immediate |
| High Finding | security@example.com | Encrypted email | 24 hours |
| Questions | pentest-lead@example.com | Slack | 4 hours |
| Emergency Stop | +1-555-SECURITY | Phone | Immediate |

### 6.4 Reporting

**Daily Standup:** 9:00 AM via Slack
**Interim Report:** Day 3
**Final Report:** Day 5 + 3 business days

---

## 7. Test Timeline

### Week 21

| Day | Focus Area | Activities |
|-----|------------|------------|
| Monday | Reconnaissance | API mapping, documentation review |
| Tuesday | Authentication | OAuth, JWT, API key testing |
| Wednesday | Authorization | RLS, IDOR, scope testing |
| Thursday | Injection | SQL, NoSQL, command injection |
| Friday | Business Logic | Workflow bypass, race conditions |

### Week 22

| Day | Focus Area | Activities |
|-----|------------|------------|
| Monday | API Fuzzing | Automated fuzzing, edge cases |
| Tuesday | Retesting | Verify reported issues |
| Wednesday | Report Prep | Documentation, evidence collection |

---

## 8. Deliverables

### 8.1 Final Report Contents

1. **Executive Summary** - High-level findings for leadership
2. **Methodology** - Tools and techniques used
3. **Findings** - Detailed vulnerability descriptions
4. **Risk Ratings** - CVSS scores and business impact
5. **Remediation** - Specific fix recommendations
6. **Evidence** - Screenshots, request/response logs
7. **Appendices** - Raw scan outputs, scripts used

### 8.2 Finding Format

```markdown
## [SEVERITY] Finding Title

### Description
[What the vulnerability is]

### Impact
[What an attacker could achieve]

### Steps to Reproduce
1. [Step 1]
2. [Step 2]
3. [Step 3]

### Evidence
[Screenshots, curl commands, etc.]

### Remediation
[Specific fix recommendation]

### References
- [CWE-XXX](link)
- [OWASP reference](link)

### CVSS Score
- Vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N
- Score: 9.1 (Critical)
```

---

## 9. Environment Details

### 9.1 Staging Environment

```yaml
api_url: https://staging-api.code-reviewer.example.com
ui_url: https://staging.code-reviewer.example.com
region: us-east-1
database: Isolated PostgreSQL (RDS)
redis: Isolated Redis (ElastiCache)
```

### 9.2 Network Access

- VPN required: No (public staging)
- IP whitelist: Optional (pentest team IPs)
- WAF: Enabled (same config as production)

### 9.3 Monitoring

- All pentest traffic logged
- Alerts suppressed for pentest tenant
- Daily log review by security team

---

## 10. Success Criteria

### 10.1 Test Completion

- [ ] All in-scope endpoints tested
- [ ] OWASP Top 10 methodology applied
- [ ] Auth/AuthZ thoroughly tested
- [ ] Multi-tenant isolation verified
- [ ] API fuzzing completed
- [ ] Final report delivered

### 10.2 Security Goals

| Goal | Target |
|------|--------|
| Critical vulnerabilities | 0 unmitigated before launch |
| High vulnerabilities | 0 unmitigated before launch |
| Medium vulnerabilities | Remediation plan documented |
| Low vulnerabilities | Tracked in backlog |

---

## 11. Contacts

| Role | Name | Email | Phone |
|------|------|-------|-------|
| Security Lead | [Name] | security-lead@example.com | +1-555-0001 |
| Platform Lead | [Name] | platform-lead@example.com | +1-555-0002 |
| DevOps Lead | [Name] | devops-lead@example.com | +1-555-0003 |
| Pentest Lead | [Name] | pentest@vendor.com | +1-555-0004 |

---

## 12. Signatures

| Role | Name | Signature | Date |
|------|------|-----------|------|
| Security Manager | | | |
| Platform Manager | | | |
| Pentest Team Lead | | | |

---

## Appendix A: Endpoint Inventory

```
GET    /health
GET    /ready
GET    /docs
POST   /api/v1/auth/github/callback
POST   /api/v1/auth/gitlab/callback
POST   /api/v1/auth/refresh
POST   /api/v1/auth/logout
GET    /api/v1/scans
POST   /api/v1/scans
GET    /api/v1/scans/:id
DELETE /api/v1/scans/:id
GET    /api/v1/scans/:id/status
GET    /api/v1/graph
GET    /api/v1/graph/search
GET    /api/v1/nodes
GET    /api/v1/nodes/:id
GET    /api/v1/nodes/:id/edges
GET    /api/v1/edges
GET    /api/v1/edges/:id
GET    /api/v1/evidence
GET    /api/v1/evidence/:id
GET    /api/v1/api-keys
POST   /api/v1/api-keys
DELETE /api/v1/api-keys/:id
GET    /api/v1/webhooks
POST   /api/v1/webhooks
DELETE /api/v1/webhooks/:id
POST   /api/v1/webhooks/github
POST   /api/v1/webhooks/gitlab
```

---

## Appendix B: Test Data Reset Procedure

```bash
# Reset pentest tenant data (run before each test session)
curl -X POST https://staging-api.code-reviewer.example.com/admin/reset-tenant \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"tenant_id": "tenant-pentest-a"}'
```

---

*Document approved for penetration testing activities. Any changes require security team approval.*
