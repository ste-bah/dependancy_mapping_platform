# ==============================================================================
# IaC Dependency Detection System - Environment Configuration
# ==============================================================================
# Copy this file to .env and configure for your environment
# Environment-specific overrides: .env.development, .env.staging, .env.production
# Local overrides (not committed): .env.local
# ==============================================================================

# ------------------------------------------------------------------------------
# Server Configuration
# ------------------------------------------------------------------------------

# Environment: development | staging | production | test
NODE_ENV=development

# Server host and port
HOST=0.0.0.0
PORT=3000

# Application version (for health checks and API responses)
APP_VERSION=0.1.0

# Request body size limit
BODY_LIMIT=10mb

# Request timeout in milliseconds
REQUEST_TIMEOUT=30000

# Trust proxy headers (set to true behind reverse proxy like nginx)
TRUST_PROXY=false

# ------------------------------------------------------------------------------
# CORS Configuration
# ------------------------------------------------------------------------------

# Allowed origins (comma-separated for multiple)
CORS_ORIGINS=http://localhost:5173,http://localhost:3000

# Allow credentials (cookies, authorization headers)
CORS_CREDENTIALS=true

# ------------------------------------------------------------------------------
# Rate Limiting
# ------------------------------------------------------------------------------

# Time window in milliseconds
RATE_LIMIT_WINDOW_MS=60000

# Maximum requests per window per IP
RATE_LIMIT_MAX=100

# ------------------------------------------------------------------------------
# Database Configuration
# ------------------------------------------------------------------------------

# Option 1: Full connection string (preferred)
DATABASE_URL=postgresql://dmp_app:dmp_secure_password@localhost:5432/dmp_db

# Option 2: Individual settings (if DATABASE_URL not set)
# DB_HOST=localhost
# DB_PORT=5432
# DB_NAME=dmp_db
# DB_USER=dmp_app
# DB_PASSWORD=dmp_secure_password

# Enable SSL for database connection
DB_SSL=false

# Connection pool settings
DB_POOL_MIN=2
DB_POOL_MAX=20
DB_IDLE_TIMEOUT=30000
DB_CONNECTION_TIMEOUT=5000

# ------------------------------------------------------------------------------
# Redis Configuration
# ------------------------------------------------------------------------------

# Option 1: Connection URL
# REDIS_URL=redis://user:password@localhost:6379/0

# Option 2: Individual settings
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Key prefix for namespacing
REDIS_KEY_PREFIX=code-reviewer:

# Enable TLS for Redis connection
REDIS_TLS=false

# Enable Redis cluster mode
REDIS_CLUSTER=false

# Connection timeouts (milliseconds)
REDIS_CONNECT_TIMEOUT=10000
REDIS_COMMAND_TIMEOUT=5000

# ------------------------------------------------------------------------------
# Queue Configuration (BullMQ)
# ------------------------------------------------------------------------------

# Worker concurrency per queue
QUEUE_CONCURRENCY=5

# Default job retry attempts
QUEUE_JOB_ATTEMPTS=3

# Backoff strategy: fixed | exponential
QUEUE_BACKOFF_TYPE=exponential

# Backoff delay in milliseconds
QUEUE_BACKOFF_DELAY=1000

# Lock duration in milliseconds
QUEUE_LOCK_DURATION=30000

# ------------------------------------------------------------------------------
# Authentication Configuration
# ------------------------------------------------------------------------------

# JWT Configuration (RS256 recommended for production)
# Generate keys: openssl genrsa -out private.pem 2048 && openssl rsa -in private.pem -pubout -out public.pem
# Escape newlines: awk 'NF {sub(/\r/, ""); printf "%s\\n",$0;}' private.pem

JWT_ALGORITHM=RS256
JWT_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----"
JWT_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----\nYOUR_PUBLIC_KEY_HERE\n-----END PUBLIC KEY-----"

# For HS256 (simpler but less secure), use JWT_SECRET instead
# JWT_ALGORITHM=HS256
# JWT_SECRET=your_jwt_secret_at_least_32_characters_long

JWT_ISSUER=code-reviewer-api
JWT_AUDIENCE=code-reviewer-client

# Token TTL in seconds
ACCESS_TOKEN_TTL=900
REFRESH_TOKEN_TTL=604800

# Session secret for cookie signing
SESSION_SECRET=your_session_secret_at_least_32_characters_long

# Password hashing rounds (10-15 recommended)
BCRYPT_ROUNDS=12

# Enable API key authentication
ENABLE_API_KEYS=true

# ------------------------------------------------------------------------------
# OAuth Configuration - GitHub
# ------------------------------------------------------------------------------

GITHUB_CLIENT_ID=your_github_client_id
GITHUB_CLIENT_SECRET=your_github_client_secret
GITHUB_REDIRECT_URI=http://localhost:3000/auth/github/callback
GITHUB_SCOPES=read:user,user:email,repo

# ------------------------------------------------------------------------------
# OAuth Configuration - GitLab (optional)
# ------------------------------------------------------------------------------

# GITLAB_CLIENT_ID=your_gitlab_client_id
# GITLAB_CLIENT_SECRET=your_gitlab_client_secret
# GITLAB_REDIRECT_URI=http://localhost:3000/auth/gitlab/callback
# GITLAB_SCOPES=read_user,read_api,read_repository

# ------------------------------------------------------------------------------
# OAuth Configuration - Bitbucket (optional)
# ------------------------------------------------------------------------------

# BITBUCKET_CLIENT_ID=your_bitbucket_client_id
# BITBUCKET_CLIENT_SECRET=your_bitbucket_client_secret
# BITBUCKET_REDIRECT_URI=http://localhost:3000/auth/bitbucket/callback

# ------------------------------------------------------------------------------
# External Services - Git Providers
# ------------------------------------------------------------------------------

# GitHub API (for repository access)
GITHUB_API_URL=https://api.github.com
GITHUB_TOKEN=ghp_your_personal_access_token
GITHUB_TIMEOUT=30000

# GitHub App authentication (alternative to personal token)
# GITHUB_APP_ID=123456
# GITHUB_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"
# GITHUB_INSTALLATION_ID=12345678

# GitLab API
GITLAB_API_URL=https://gitlab.com/api/v4
GITLAB_TOKEN=glpat-your_personal_access_token
GITLAB_TIMEOUT=30000

# Bitbucket API
BITBUCKET_API_URL=https://api.bitbucket.org/2.0
BITBUCKET_USERNAME=your_username
BITBUCKET_TOKEN=your_app_password
BITBUCKET_TIMEOUT=30000

# ------------------------------------------------------------------------------
# External Services - Registries
# ------------------------------------------------------------------------------

# Terraform Registry
TERRAFORM_REGISTRY_URL=https://registry.terraform.io
TERRAFORM_REGISTRY_TIMEOUT=10000
TERRAFORM_REGISTRY_RETRIES=3
# TERRAFORM_REGISTRY_TOKEN=your_terraform_cloud_token

# Helm Repositories (configured via API or config file)

# ------------------------------------------------------------------------------
# Parser Configuration
# ------------------------------------------------------------------------------

# Terraform parser
TERRAFORM_MAX_FILE_SIZE=10485760
TERRAFORM_ENABLE_HCL2=true
TERRAFORM_PARSE_TIMEOUT=60000

# Helm parser
HELM_MAX_CHART_SIZE=52428800
HELM_PARSE_TIMEOUT=60000

# ------------------------------------------------------------------------------
# Detection Engine Configuration
# ------------------------------------------------------------------------------

# Minimum confidence threshold for dependencies (0.0 - 1.0)
DETECTION_CONFIDENCE_THRESHOLD=0.7

# Maximum graph traversal depth
DETECTION_MAX_GRAPH_DEPTH=50

# Enable circular dependency detection
DETECTION_ENABLE_CYCLE_DETECTION=true

# Number of parallel detection workers
DETECTION_PARALLEL_DETECTORS=4

# Timeouts (milliseconds)
DETECTION_TIMEOUT_PER_FILE=30000
DETECTION_TOTAL_TIMEOUT=300000

# Maximum files per scan
DETECTION_MAX_FILES_PER_SCAN=10000

# Maximum graph nodes
DETECTION_MAX_GRAPH_NODES=100000

# Detection result caching
DETECTION_ENABLE_CACHING=true
DETECTION_CACHE_TTL=3600

# ------------------------------------------------------------------------------
# Logging Configuration
# ------------------------------------------------------------------------------

# Log level: trace | debug | info | warn | error | fatal
LOG_LEVEL=info

# Enable pretty printing (development only)
LOG_PRETTY=true

# Log destination: console | file | both
LOG_DESTINATION=console

# Log file path (when destination is file or both)
# LOG_FILE_PATH=/var/log/code-reviewer/app.log

# Request/response logging
LOG_REQUESTS=true
LOG_RESPONSES=false

# ------------------------------------------------------------------------------
# Monitoring Configuration
# ------------------------------------------------------------------------------

# Sentry error tracking
# SENTRY_DSN=https://your-key@sentry.io/project
# SENTRY_ENVIRONMENT=development

# Prometheus metrics
PROMETHEUS_ENABLED=false
PROMETHEUS_PATH=/metrics

# Health checks
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health

# ------------------------------------------------------------------------------
# Storage Configuration
# ------------------------------------------------------------------------------

# Storage provider: local | s3 | gcs | azure
STORAGE_PROVIDER=local

# Local storage path
STORAGE_LOCAL_PATH=/tmp/code-reviewer

# S3 configuration
# S3_BUCKET=your-bucket-name
# S3_REGION=us-east-1
# S3_ENDPOINT=https://s3.amazonaws.com
# AWS_ACCESS_KEY_ID=your_access_key
# AWS_SECRET_ACCESS_KEY=your_secret_key

# GCS configuration
# GCS_BUCKET=your-bucket-name
# GOOGLE_APPLICATION_CREDENTIALS=/path/to/credentials.json

# Azure Blob Storage
# AZURE_CONTAINER=your-container-name
# AZURE_STORAGE_CONNECTION_STRING=your_connection_string

# Maximum upload size in bytes
MAX_UPLOAD_SIZE=104857600

# ------------------------------------------------------------------------------
# Feature Flags
# ------------------------------------------------------------------------------

# Enable asynchronous scanning
FEATURE_ASYNC_SCANNING=true

# Enable webhook notifications
FEATURE_WEBHOOKS=true

# Enable metrics collection
FEATURE_METRICS=true

# Enable caching layer
FEATURE_CACHING=true

# Enable GraphQL API (experimental)
FEATURE_GRAPHQL=false

# Experimental features
FEATURE_EXPERIMENTAL_HELM_V3=false
FEATURE_EXPERIMENTAL_K8S_OPERATORS=false
FEATURE_EXPERIMENTAL_AI_DETECTION=false

# Debug mode
DEBUG_MODE=false

# Verbose error messages in API responses
VERBOSE_ERRORS=false

# JSON-formatted feature flags (alternative to individual settings)
# FEATURE_FLAGS={"enableAsyncScanning":true,"enableWebhooks":true,"debugMode":false}

# ------------------------------------------------------------------------------
# Tenant Configuration
# ------------------------------------------------------------------------------

# If true, all non-health routes require X-Tenant-ID header
TENANT_REQUIRED=false

# ------------------------------------------------------------------------------
# External Object Index Configuration
# TASK-ROLLUP-003: External Object Index with reverse lookup support
# NFR-PERF-008: Performance target 100K nodes < 500ms
# ------------------------------------------------------------------------------

# L1 (In-Memory) Cache Configuration
# Maximum number of entries in L1 cache (100-100000, default: 10000)
EXTERNAL_INDEX_CACHE_L1_MAX_ENTRIES=10000
# TTL for L1 cache entries in milliseconds (1000-3600000, default: 300000 = 5 minutes)
EXTERNAL_INDEX_CACHE_L1_TTL_MS=300000

# L2 (Redis) Cache Configuration
# TTL for L2 cache entries in milliseconds (60000-86400000, default: 3600000 = 1 hour)
EXTERNAL_INDEX_CACHE_L2_TTL_MS=3600000
# Redis key prefix for external index cache
EXTERNAL_INDEX_CACHE_L2_PREFIX=ext-idx:

# Indexing Configuration
# Batch size for processing nodes during index build (100-5000, default: 1000)
EXTERNAL_INDEX_BATCH_SIZE=1000
# Maximum concurrent index build operations (1-10, default: 3)
EXTERNAL_INDEX_MAX_CONCURRENT_BUILDS=3
# Index build timeout in milliseconds (60000-1800000, default: 300000 = 5 minutes)
EXTERNAL_INDEX_BUILD_TIMEOUT_MS=300000

# Performance Configuration (NFR-PERF-008)
# Single lookup timeout in milliseconds (10-1000, default: 100) - Target for NFR-PERF-008
EXTERNAL_INDEX_LOOKUP_TIMEOUT_MS=100
# Reverse lookup timeout in milliseconds (100-5000, default: 500)
EXTERNAL_INDEX_REVERSE_LOOKUP_TIMEOUT_MS=500
# Maximum items per batch lookup request (10-1000, default: 100)
EXTERNAL_INDEX_MAX_BATCH_LOOKUP_SIZE=100

# Extraction Configuration
# Comma-separated list of external reference types to extract
# Valid types: arn, container_image, tf_registry_module, git_url, helm_chart, url, cloud_resource_id, secret_ref, dns_name, s3_path
EXTERNAL_INDEX_ENABLED_TYPES=arn,container_image,cloud_resource_id,helm_chart,git_url
# Maximum external references per node (10-500, default: 100)
EXTERNAL_INDEX_MAX_REFERENCES_PER_NODE=100
# Minimum confidence score for including references (0-1, default: 0.5)
EXTERNAL_INDEX_CONFIDENCE_THRESHOLD=0.5

# ------------------------------------------------------------------------------
# Documentation Configuration (TASK-FINAL-004)
# ------------------------------------------------------------------------------

# Swagger/OpenAPI UI Configuration
# Enable Swagger UI for API documentation
SWAGGER_ENABLED=true
# URL prefix for Swagger UI (e.g., /docs, /api-docs)
SWAGGER_ROUTE_PREFIX=/docs
# Expose Swagger route publicly
SWAGGER_EXPOSE_ROUTE=true

# OpenAPI Specification Configuration
# API title shown in documentation
OPENAPI_TITLE=Code-Reviewer API
# API version string
OPENAPI_VERSION=1.0.0
# API description (optional)
# OPENAPI_DESCRIPTION=Infrastructure code dependency detection and analysis API
# Contact email for API support (optional)
# OPENAPI_CONTACT_EMAIL=support@code-reviewer.io
# License name
OPENAPI_LICENSE=MIT
# External documentation URL (optional)
# OPENAPI_EXTERNAL_DOCS_URL=https://docs.code-reviewer.io

# Docusaurus Documentation Site Configuration
# Base URL for documentation site
DOCS_BASE_URL=/
# Deployment URL for the documentation site
# DOCS_DEPLOY_URL=https://docs.code-reviewer.io
# Enable GitHub edit links in documentation
DOCS_ENABLE_EDIT_LINKS=true
# GitHub organization for documentation repository
# DOCS_GITHUB_ORG=your-org
# GitHub repository name for documentation
# DOCS_GITHUB_REPO=code-reviewer-docs

# ------------------------------------------------------------------------------
# Beta Program Configuration (TASK-FINAL-004)
# ------------------------------------------------------------------------------

# Maximum number of beta customers allowed
BETA_MAX_CUSTOMERS=50
# Require NDA signature before onboarding
BETA_REQUIRE_NDA=true
# Beta program start date (YYYY-MM-DD format, optional)
# BETA_START_DATE=2024-03-01
# Beta program end date (YYYY-MM-DD format, optional)
# BETA_END_DATE=2024-06-01
# Enable waitlist for beta program
BETA_WAITLIST_ENABLED=true
# Enable feedback collection from beta users
BETA_FEEDBACK_ENABLED=true

# ------------------------------------------------------------------------------
# Launch Configuration (TASK-FINAL-004)
# ------------------------------------------------------------------------------

# Target launch date (YYYY-MM-DD format, optional)
# LAUNCH_TARGET_DATE=2024-07-01
# Require all critical items to be complete before launch
LAUNCH_CRITICAL_ITEMS_REQUIRED=true
# Minimum test coverage percentage required for launch (0-100)
LAUNCH_MIN_TEST_COVERAGE=80
# Require security audit completion before launch
LAUNCH_REQUIRE_SECURITY_AUDIT=true
# Require performance benchmarks before launch
LAUNCH_REQUIRE_PERF_BENCHMARKS=true
# Target launch environment: staging | production
LAUNCH_ENVIRONMENT=production
